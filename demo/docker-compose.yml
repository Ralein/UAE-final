version: "3.9"

services:
  # ----- Spring Boot Application -----
  app:
    build:
      context: .
      dockerfile: Dockerfile
    ports:
      - "8080:8080"
    environment:
      SPRING_PROFILES_ACTIVE: default
      SUPABASE_DB_URL: ${SUPABASE_DB_URL}
      SUPABASE_DB_USERNAME: ${SUPABASE_DB_USERNAME}
      SUPABASE_DB_PASSWORD: ${SUPABASE_DB_PASSWORD}
      UPSTASH_REDIS_URL: ${UPSTASH_REDIS_URL}
      UAEPASS_CLIENT_ID: ${UAEPASS_CLIENT_ID}
      UAEPASS_CLIENT_SECRET: ${UAEPASS_CLIENT_SECRET}
    healthcheck:
      test: [ "CMD", "wget", "--quiet", "--tries=1", "--spider", "http://localhost:8080/actuator/health" ]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 30s
    restart: unless-stopped

  # ----- UAE PASS Hash-Signing SDK -----
  # Replace the image below with the actual Docker image provided
  # by the UAE PASS onboarding team during SP registration.
  hash-signing-sdk:
    image: uaepass-esign:local # REPLACE with actual Docker image from UAE PASS onboarding team
    ports:
      - "8081:8081"
    environment:
      # Add SDK-specific env vars as provided by UAE PASS team
      SDK_MODE: staging
    restart: unless-stopped
